{% extends 'base.html' %}

{% load l10n %}

{% block content %}
              {% if request.user.is_anonymous %}
              <style>
                #content {
                    border: 1px solid #635240;
                    opacity: 0.9;
                }
                .banner {
                    text-align: center;padding: 10% 0 10% 0;
                }
                .banner h3, .banner div {
                    font-size: 400%;
                }
              </style>
              <div class="banner">
                  <h3><i class="fa fa-database"></i> ACLARK.NET, LLC &mdash; DB </h3>
                  <div>Client & Contractor Database Application</div>
                  <span>&copy; 2016 ACLARK.NET, LLC</span>
                  <div><a href="https://github.com/ACLARKNET/aclarknet-database"><i class="fa fa-github"></i></a></div>
              </div> 
              {% endif %}
              {% if request.user.is_authenticated %}
              <h3>Dashboard<a class="btn btn-lg btn-success pull-right" href="{% url 'entry_edit' %}">Add Time <i class="fa fa-plus"></i></a></h3><hr>
              {% if not request.user.is_staff %}<h4>Welcome to the ACLARK.NET, LLC Client & Contractor Database. Please <a href="{% url 'user_edit' request.user.pk %}">enter your hourly rate</a> and <a href="https://github.com/aclarknet/aclarknet-database/issues">report issues here</a>.</h4>{% endif %}
              {% endif %}
              {% if request.user.is_staff %}
              <div class="row">
                <div class="col-md-12">
                  <h4>Totals</h4>
                  <table class="table table-bordered">
                    <thead>
                      <tr>
                        <th>Gross</th> 
                        <th>Net</th> 
                      </tr>
                    </thead> 
                    <tbody>
                      <tr>
                        <td class="light"><h4>{{ company.currency_symbol }}{{ gross }}</h4></td>
                        <td class="currency"><h4>{{ company.currency_symbol }}{{ net }}</h4></td>
                      </tr>
                    </tbody>
                  </table>
                  <table class="table table-bordered"> 
                    <thead>
                      <tr>
                        <th align="center" colspan=2><i class="fa fa-user"></i> Contacts</th> 
                        <th align="center" colspan=2><i class="fa fa-user"></i> Clients</th> 
                        <th align="center" colspan=2><i class="fa fa-cog"></i> Projects</th> 
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td align="center" class="light"><strong>Total</strong><br>{{ contacts.count|default:0 }}</td>
                        <td align="center" class="currency"><strong>Active</strong><br><a href="{% url 'contact_index' %}?active=true">{{ contacts_active.count|default:0 }}</a></td>
                        <td align="center" class="light"><strong>Total</strong><br>{{ clients.count|default:0 }}</td>
                        <td align="center" class="currency"><strong>Active</strong><br><a href="{% url 'client_index' %}?active=true">{{ clients_active.count|default:0 }}</a></td>
                        <td align="center" class="light"><strong>Total</strong><br>{{ projects.count|default:0 }}</td>
                        <td align="center" class="currency"><strong>Active</strong><br><a href="{% url 'project_index' %}?active=true">{{ projects_active.count|default:0 }}</a></td>
                      </tr>
                    </tbody>
                  </table>
                  <table class="table table-bordered"> 
                    <thead>
                      <tr>
                        <th align="center" colspan=2><i class="fa fa-clock-o"></i> Times</th> 
                        <th align="center" colspan=2><i class="fa fa-file-o"></i> Invoices</th> 
                        <th align="center" colspan=2><i class="fa fa-file-o"></i> Estimates</th> 
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td align="center" class="light"><strong>Total</strong><br>{{ times.count|default:0 }}</td>
                        <td align="center" class="currency"><strong>Active</strong><br><a href="{% url 'entry_index' %}?active=true">{{ times_active.count|default:0 }}</a></td>
                        <td align="center" class="light"><strong>Total</strong><br>{{ invoices.count|default:0 }}</td>
                        <td align="center" class="currency"><strong>Active</strong><br><a href="{% url 'invoice_index' %}?active=true">{{ invoices_active.count|default:0 }}</a></td>
                        <td align="center" class="light"><strong>Total</strong><br>{{ estimates.count|default:0 }}</td>
                        <td align="center" class="currency"><strong>Active</strong><br><a href="{% url 'estimate_index' %}?active=true">{{ estimates_active.count|default:0 }}</a></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              {% endif %}
              {% if request.user.is_staff %}
              <div class="row">
                <div class="col-md-6">
                  <h4>Active Projects</h4>
                  <table data-toggle="table"> 
                    <thead>
                      <tr>
                        <th>Edit</th>
                        <th data-field="name" data-sort-name="hidden-name" data-sortable="true">Name</th>
                        <th data-field="hidden-name" data-sortable="true" data-visible="false">Hidden Name</th>
                        <th data-field="task" data-sort-name="hidden-task" data-sortable="true">Task</th>
                        <th data-field="hidden-task" data-sortable="true" data-visible="false">Hidden Task</th>
                        <th data-field="start-date" data-sort-name="hidden-start-date" data-sortable="true">Start Date</th>
                        <th data-field="hidden-start-date" data-sortable="true" data-visible="false">Hidden Start Date</th>
                        <th data-field="end-date" data-sort-name="hidden-end-date" data-sortable="true">End Date</th>
                        <th data-field="hidden-end-date" data-sortable="true" data-visible="false">Hidden End Date</th>
                      <tr> 
                    </thead>
                    <tbody>
                    {% for project in projects_active %}
                      <tr>
                        <td><a href="{% url 'project_edit' project.pk %}"><i class="fa fa-edit fa-2x"></i></a></td>
                        <td><a href="{% url 'project' project.pk %}">{{ project.name }}</a></td>
                        <td>{{ project.name }}</td>
                        {% if project.task %}
                          <td><a href="{% url 'task' project.task.pk %}">{{ project.task.name }}</a></td>
                        {% else %}
                          <td></td>
                        {% endif %}
                        <td>{{ project.task.name }}</td>
                        <td>{{ project.start_date|date:'m/d/Y'|default:'' }}</td>
                        <td>{{ project.start_date|date:'U' }}</td>
                        <td>{{ project.end_date|date:'m/d/Y'|default:'' }}</td>
                        <td>{{ project.end_date|date:'U' }}</td>
                      </tr>
                    {% endfor %}
                    </tbody>
                  </table>
                </div>
                <div class="col-md-6">
                  <h4>Current Invoices</h4>
                  <table data-toggle="table"> 
                    <thead>
                      <tr>
                        <th data-field="invoice" data-sortable="true">Invoice</th>
                        <th data-field="project" data-sort-name="hidden-project" data-sortable="true">Project</th>
                        <th data-field="hidden-project" data-sortable="true" data-visible="false">Hidden Project</th>
                        <th data-field="gross" data-sort-name="hidden-gross" data-sortable="true">Gross</th>
                        <th data-field="hidden-gross" data-sortable="true" data-visible="false">Hidden Gross</th>
                        <th data-field="net" data-sort-name="hidden-net" data-sortable="true">Net</th>
                        <th data-field="hidden-net" data-sortable="true" data-visible="false">Hidden Net</th>
                      <tr> 
                    </thead>
                    <tbody>
                    {% for invoice in invoices_active %}
                      <tr>
                        {% if invoice.document_id %}
                            <td><a href="{% url 'invoice' invoice.pk %}">{{ invoice.document_id }}</a></td>
                        {% else %}
                            <td></td>
                        {% endif %}
                        {% if invoice.project %}
                            <td><a href="{% url 'project' invoice.project.pk %}">{{ invoice.project.name }}</a></td>
                        {% else %}
                            <td></td>
                        {% endif %}
                        <td>{{ invoice.project }}</td>
                        <td>{{ company.currency_symbol }}{{ invoice.subtotal|default:0 }}</td>
                        <td>{{ invoice.subtotal|unlocalize|default:0 }}</td>
                        <td>{{ company.currency_symbol }}{{ invoice.amount|default:0 }}</td>
                        <td>{{ invoice.amount|unlocalize|default:0 }}</td>
                      </tr>
                    {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
              {% endif %}
{% endblock %}
